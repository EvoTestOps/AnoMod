        -:    0:Source:/social-network-microservices/src/MediaService/MediaHandler.h
        -:    0:Graph:/social-network-microservices/build/src/MediaService/CMakeFiles/MediaService.dir/MediaService.cpp.gcno
        -:    0:Data:/social-network-microservices/build/src/MediaService/CMakeFiles/MediaService.dir/MediaService.cpp.gcda
        -:    0:Runs:1
        -:    0:Programs:1
        -:    1:#ifndef SOCIAL_NETWORK_MICROSERVICES_SRC_MEDIASERVICE_MEDIAHANDLER_H_
        -:    2:#define SOCIAL_NETWORK_MICROSERVICES_SRC_MEDIASERVICE_MEDIAHANDLER_H_
        -:    3:
        -:    4:#include <chrono>
        -:    5:#include <iostream>
        -:    6:#include <string>
        -:    7:
        -:    8:#include "../../gen-cpp/MediaService.h"
        -:    9:#include "../logger.h"
        -:   10:#include "../tracing.h"
        -:   11:
        -:   12:// 2018-01-01 00:00:00 UTC
        -:   13:#define CUSTOM_EPOCH 1514764800000
        -:   14:
        -:   15:namespace social_network {
        -:   16:
        -:   17:class MediaHandler : public MediaServiceIf {
        -:   18: public:
function _ZN14social_network12MediaHandlerC2Ev called 1 returned 100% blocks executed 100%
        1:   19:  MediaHandler() = default;
call    0 returned 100%
function _ZN14social_network12MediaHandlerD0Ev called 0 returned 0% blocks executed 0%
function _ZN14social_network12MediaHandlerD2Ev called 0 returned 0% blocks executed 0%
    #####:   20:  ~MediaHandler() override = default;
call    0 never executed
call    1 never executed
call    2 never executed
branch  3 never executed
branch  4 never executed
call    5 never executed
        -:   21:
        -:   22:  void ComposeMedia(std::vector<Media> &_return, int64_t,
        -:   23:                    const std::vector<std::string> &,
        -:   24:                    const std::vector<int64_t> &,
        -:   25:                    const std::map<std::string, std::string> &) override;
        -:   26:
        -:   27: private:
        -:   28:};
        -:   29:
function _ZN14social_network12MediaHandler12ComposeMediaERSt6vectorINS_5MediaESaIS2_EElRKS1_INSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESaISB_EERKS1_IlSaIlEERKSt3mapISB_SB_St4lessISB_ESaISt4pairIKSB_SB_EEE called 200 returned 100% blocks executed 68%
      200:   30:void MediaHandler::ComposeMedia(
        -:   31:    std::vector<Media> &_return, int64_t req_id,
        -:   32:    const std::vector<std::string> &media_types,
        -:   33:    const std::vector<int64_t> &media_ids,
        -:   34:    const std::map<std::string, std::string> &carrier) {
        -:   35:  // 新增：记录收到的请求
      800:   36:  LOG(info) << "Received ComposeMedia request [req_id=" << req_id 
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
branch 10 taken 50% (fallthrough)
branch 11 taken 50%
call   12 returned 100%
branch 13 taken 100% (fallthrough)
branch 14 taken 0%
call   15 returned 100%
call   16 returned 100%
branch 17 taken 100% (fallthrough)
branch 18 taken 0% (throw)
call   19 returned 100%
call   20 returned 100%
branch 21 taken 100% (fallthrough)
branch 22 taken 0% (throw)
call   23 returned 100%
branch 24 taken 100% (fallthrough)
branch 25 taken 0% (throw)
call   26 returned 100%
branch 27 taken 100% (fallthrough)
branch 28 taken 0% (throw)
call   29 returned 100%
branch 30 taken 100% (fallthrough)
branch 31 taken 0% (throw)
call   32 returned 100%
branch 33 taken 100% (fallthrough)
branch 34 taken 0% (throw)
call   35 returned 100%
branch 36 taken 100% (fallthrough)
branch 37 taken 0% (throw)
call   38 returned 100%
branch 39 taken 100% (fallthrough)
branch 40 taken 0% (throw)
call   41 returned 100%
branch 42 taken 100% (fallthrough)
branch 43 taken 0% (throw)
call   44 returned 100%
branch 45 taken 100% (fallthrough)
branch 46 taken 0% (throw)
call   47 returned 100%
branch 48 taken 100% (fallthrough)
branch 49 taken 0% (throw)
call   50 returned 100%
call   51 never executed
call   52 never executed
call   53 never executed
      400:   37:            << ", media_ids count=" << media_ids.size() 
call    0 returned 100%
call    1 returned 100%
branch  2 taken 100% (fallthrough)
branch  3 taken 0% (throw)
call    4 returned 100%
branch  5 taken 100% (fallthrough)
branch  6 taken 0% (throw)
      400:   38:            << ", media_types count=" << media_types.size() << "]";
call    0 returned 100%
call    1 returned 100%
branch  2 taken 100% (fallthrough)
branch  3 taken 0% (throw)
call    4 returned 100%
branch  5 taken 100% (fallthrough)
branch  6 taken 0% (throw)
call    7 returned 100%
branch  8 taken 100% (fallthrough)
branch  9 taken 0% (throw)
        -:   39:
        -:   40:  // Initialize a span
      400:   41:  TextMapReader reader(carrier);
call    0 returned 100%
call    1 returned 100%
call    2 never executed
      400:   42:  std::map<std::string, std::string> writer_text_map;
call    0 returned 100%
call    1 returned 100%
call    2 never executed
      400:   43:  TextMapWriter writer(writer_text_map);
call    0 returned 100%
call    1 returned 100%
call    2 never executed
      400:   44:  auto parent_span = opentracing::Tracer::Global()->Extract(reader);
call    0 returned 100%
call    1 returned 100%
call    2 returned 100%
branch  3 taken 100% (fallthrough)
branch  4 taken 0% (throw)
call    5 returned 100%
call    6 returned 100%
call    7 never executed
      400:   45:  auto span = opentracing::Tracer::Global()->StartSpan(
call    0 returned 100%
      800:   46:      "compose_media_server", {opentracing::ChildOf(parent_span->get())});
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
call    4 returned 100%
call    5 returned 100%
call    6 returned 100%
call    7 returned 100%
call    8 returned 100%
call    9 returned 100%
call   10 returned 100%
call   11 returned 100%
call   12 never executed
      200:   47:  opentracing::Tracer::Global()->Inject(span->context(), writer);
call    0 returned 100%
call    1 returned 100%
call    2 returned 100%
call    3 returned 100%
call    4 returned 100%
branch  5 taken 100% (fallthrough)
branch  6 taken 0% (throw)
call    7 returned 100%
call    8 returned 100%
call    9 never executed
        -:   48:
      200:   49:  if (media_types.size() != media_ids.size()) {
call    0 returned 100%
call    1 returned 100%
branch  2 taken 0% (fallthrough)
branch  3 taken 100%
    #####:   50:    ServiceException se;
call    0 never executed
call    1 never executed
    #####:   51:    se.errorCode = ErrorCode::SE_THRIFT_HANDLER_ERROR;
        -:   52:    se.message =
    #####:   53:        "The lengths of media_id list and media_type list are not equal";
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:   54:    throw se;
call    0 never executed
call    1 never executed
branch  2 never executed
branch  3 never executed
call    4 never executed
call    5 never executed
        -:   55:  }
        -:   56:
        -:   57:  // 新增：校验通过
      400:   58:  LOG(info) << "ComposeMedia parameter validation passed [req_id=" << req_id << "]";
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
branch 10 taken 50% (fallthrough)
branch 11 taken 50%
call   12 returned 100%
branch 13 taken 100% (fallthrough)
branch 14 taken 0%
call   15 returned 100%
call   16 returned 100%
branch 17 taken 100% (fallthrough)
branch 18 taken 0% (throw)
call   19 returned 100%
call   20 returned 100%
branch 21 taken 100% (fallthrough)
branch 22 taken 0% (throw)
call   23 returned 100%
branch 24 taken 100% (fallthrough)
branch 25 taken 0% (throw)
call   26 returned 100%
branch 27 taken 100% (fallthrough)
branch 28 taken 0% (throw)
call   29 returned 100%
branch 30 taken 100% (fallthrough)
branch 31 taken 0% (throw)
call   32 returned 100%
branch 33 taken 100% (fallthrough)
branch 34 taken 0% (throw)
call   35 returned 100%
branch 36 taken 100% (fallthrough)
branch 37 taken 0% (throw)
call   38 returned 100%
branch 39 taken 100% (fallthrough)
branch 40 taken 0% (throw)
call   41 returned 100%
branch 42 taken 100% (fallthrough)
branch 43 taken 0% (throw)
call   44 returned 100%
branch 45 taken 100% (fallthrough)
branch 46 taken 0% (throw)
call   47 returned 100%
branch 48 taken 100% (fallthrough)
branch 49 taken 0% (throw)
call   50 returned 100%
branch 51 taken 100% (fallthrough)
branch 52 taken 0% (throw)
call   53 returned 100%
call   54 never executed
call   55 never executed
        -:   59:
      200:   60:  for (int i = 0; i < media_ids.size(); ++i) {
call    0 returned 100%
branch  1 taken 0% (fallthrough)
branch  2 taken 100%
    #####:   61:    Media new_media;
call    0 never executed
call    1 never executed
call    2 never executed
    #####:   62:    new_media.media_id = media_ids[i];
call    0 never executed
    #####:   63:    new_media.media_type = media_types[i];
call    0 never executed
call    1 never executed
branch  2 never executed
branch  3 never executed
    #####:   64:    _return.emplace_back(new_media);
call    0 never executed
branch  1 never executed
branch  2 never executed
        -:   65:  }
        -:   66:
        -:   67:  // 新增：方法结束日志
      800:   68:  LOG(info) << "ComposeMedia completed [req_id=" << req_id 
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
branch 10 taken 50% (fallthrough)
branch 11 taken 50%
call   12 returned 100%
branch 13 taken 100% (fallthrough)
branch 14 taken 0%
call   15 returned 100%
call   16 returned 100%
branch 17 taken 100% (fallthrough)
branch 18 taken 0% (throw)
call   19 returned 100%
call   20 returned 100%
branch 21 taken 100% (fallthrough)
branch 22 taken 0% (throw)
call   23 returned 100%
branch 24 taken 100% (fallthrough)
branch 25 taken 0% (throw)
call   26 returned 100%
branch 27 taken 100% (fallthrough)
branch 28 taken 0% (throw)
call   29 returned 100%
branch 30 taken 100% (fallthrough)
branch 31 taken 0% (throw)
call   32 returned 100%
branch 33 taken 100% (fallthrough)
branch 34 taken 0% (throw)
call   35 returned 100%
branch 36 taken 100% (fallthrough)
branch 37 taken 0% (throw)
call   38 returned 100%
branch 39 taken 100% (fallthrough)
branch 40 taken 0% (throw)
call   41 returned 100%
branch 42 taken 100% (fallthrough)
branch 43 taken 0% (throw)
call   44 returned 100%
branch 45 taken 100% (fallthrough)
branch 46 taken 0% (throw)
call   47 returned 100%
branch 48 taken 100% (fallthrough)
branch 49 taken 0% (throw)
call   50 returned 100%
call   51 never executed
call   52 never executed
      400:   69:            << ", return media count=" << _return.size() << "]";
call    0 returned 100%
call    1 returned 100%
branch  2 taken 100% (fallthrough)
branch  3 taken 0% (throw)
call    4 returned 100%
branch  5 taken 100% (fallthrough)
branch  6 taken 0% (throw)
call    7 returned 100%
branch  8 taken 100% (fallthrough)
branch  9 taken 0% (throw)
        -:   70:
      200:   71:  span->Finish();
call    0 returned 100%
call    1 returned 100%
      200:   72:}
        -:   73:
        -:   74:}  // namespace social_network
        -:   75:
        -:   76:#endif  // SOCIAL_NETWORK_MICROSERVICES_SRC_MEDIASERVICE_MEDIAHANDLER_H_
