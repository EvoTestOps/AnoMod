        -:    0:Source:/social-network-microservices/src/utils_mongodb.h
        -:    0:Graph:/social-network-microservices/build/src/PostStorageService/CMakeFiles/PostStorageService.dir/PostStorageService.cpp.gcno
        -:    0:Data:/social-network-microservices/build/src/PostStorageService/CMakeFiles/PostStorageService.dir/PostStorageService.cpp.gcda
        -:    0:Runs:1
        -:    0:Programs:1
        -:    1:#ifndef SOCIAL_NETWORK_MICROSERVICES_SRC_UTILS_MONGODB_H_
        -:    2:#define SOCIAL_NETWORK_MICROSERVICES_SRC_UTILS_MONGODB_H_
        -:    3:
        -:    4:#include <mongoc.h>
        -:    5:#include <bson/bson.h>
        -:    6:
        -:    7:#define SERVER_SELECTION_TIMEOUT_MS 300
        -:    8:
        -:    9:namespace social_network {
        -:   10:
function _ZN14social_network24init_mongodb_client_poolERKN8nlohmann10basic_jsonISt3mapSt6vectorNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEblmdSaNS0_14adl_serializerEEERKS9_j called 1 returned 100% blocks executed 37%
        1:   11:mongoc_client_pool_t* init_mongodb_client_pool(
        -:   12:    const json &config_json,
        -:   13:    const std::string &service_name,
        -:   14:    uint32_t max_size
        -:   15:) {
        2:   16:  std::string addr = config_json[service_name + "-mongodb"]["addr"];
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
branch 10 taken 100% (fallthrough)
branch 11 taken 0% (throw)
call   12 returned 100%
call   13 returned 100%
call   14 never executed
call   15 never executed
        1:   17:  int port = config_json[service_name + "-mongodb"]["port"];
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
branch 10 taken 100% (fallthrough)
branch 11 taken 0% (throw)
call   12 returned 100%
call   13 never executed
call   14 never executed
        2:   18:  std::string uri_str = "mongodb://" + addr + ":" +
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
call   10 returned 100%
call   11 never executed
call   12 never executed
call   13 never executed
        4:   19:      std::to_string(port) + "/?appname=" + service_name + "-service";
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
branch 10 taken 100% (fallthrough)
branch 11 taken 0% (throw)
call   12 returned 100%
call   13 returned 100%
call   14 returned 100%
call   15 returned 100%
call   16 returned 100%
call   17 never executed
call   18 never executed
call   19 never executed
        -:   20:  uri_str += "&" MONGOC_URI_SERVERSELECTIONTIMEOUTMS "="
        1:   21:      + std::to_string(SERVER_SELECTION_TIMEOUT_MS);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
call    9 returned 100%
call   10 returned 100%
call   11 never executed
call   12 never executed
        -:   22:
        1:   23:  mongoc_init();
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        -:   24:  bson_error_t error;
        -:   25:  mongoc_uri_t *mongodb_uri =
        1:   26:      mongoc_uri_new_with_error(uri_str.c_str(), &error);
call    0 returned 100%
call    1 returned 100%
branch  2 taken 100% (fallthrough)
branch  3 taken 0% (throw)
        -:   27:
        1:   28:  if (!mongodb_uri) {
branch  0 taken 0% (fallthrough)
branch  1 taken 100%
    #####:   29:    LOG(fatal) << "Error: failed to parse URI" << std::endl
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
call    6 never executed
branch  7 never executed
branch  8 never executed
call    9 never executed
branch 10 never executed
branch 11 never executed
call   12 never executed
branch 13 never executed
branch 14 never executed
call   15 never executed
call   16 never executed
branch 17 never executed
branch 18 never executed
call   19 never executed
call   20 never executed
branch 21 never executed
branch 22 never executed
call   23 never executed
branch 24 never executed
branch 25 never executed
call   26 never executed
branch 27 never executed
branch 28 never executed
call   29 never executed
branch 30 never executed
branch 31 never executed
call   32 never executed
branch 33 never executed
branch 34 never executed
call   35 never executed
branch 36 never executed
branch 37 never executed
call   38 never executed
branch 39 never executed
branch 40 never executed
call   41 never executed
branch 42 never executed
branch 43 never executed
call   44 never executed
branch 45 never executed
branch 46 never executed
call   47 never executed
branch 48 never executed
branch 49 never executed
call   50 never executed
call   51 never executed
call   52 never executed
    #####:   30:              << "error message: " << std::endl
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
    #####:   31:              << uri_str << std::endl
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
    #####:   32:              << error.message<< std::endl;
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
    #####:   33:    return nullptr;
        -:   34:  } else {
        1:   35:    if (config_json["ssl"]["enabled"]) {
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
call    3 returned 100%
branch  4 taken 100% (fallthrough)
branch  5 taken 0% (throw)
call    6 returned 100%
branch  7 taken 100% (fallthrough)
branch  8 taken 0% (throw)
branch  9 taken 0% (fallthrough)
branch 10 taken 100%
    #####:   36:      std::string ca_file = config_json["ssl"]["caPath"];
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
call    6 never executed
branch  7 never executed
branch  8 never executed
call    9 never executed
call   10 never executed
        -:   37:
    #####:   38:      mongoc_uri_set_option_as_bool(mongodb_uri, MONGOC_URI_TLS, true);
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:   39:      mongoc_uri_set_option_as_utf8(mongodb_uri, MONGOC_URI_TLSCAFILE, ca_file.c_str());
call    0 never executed
call    1 never executed
branch  2 never executed
branch  3 never executed
    #####:   40:      mongoc_uri_set_option_as_bool(mongodb_uri, MONGOC_URI_TLSALLOWINVALIDHOSTNAMES, true);
call    0 never executed
branch  1 never executed
branch  2 never executed
        -:   41:    }
        -:   42:
        1:   43:    mongoc_client_pool_t *client_pool= mongoc_client_pool_new(mongodb_uri);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   44:    mongoc_client_pool_max_size(client_pool, max_size);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   45:    return client_pool;
        -:   46:  }
        -:   47:}
        -:   48:
function _ZN14social_network11CreateIndexEP16_mongoc_client_tRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES9_b called 1 returned 100% blocks executed 43%
        1:   49:bool CreateIndex(
        -:   50:    mongoc_client_t *client,
        -:   51:    const std::string &db_name,
        -:   52:    const std::string &index,
        -:   53:    bool unique) {
        -:   54:  mongoc_database_t *db;
        -:   55:  bson_t keys;
        -:   56:  char *index_name;
        -:   57:  bson_t *create_indexes;
        -:   58:  bson_t reply;
        -:   59:  bson_error_t error;
        -:   60:  bool r;
        -:   61:
        1:   62:  db = mongoc_client_get_database(client, db_name.c_str());
call    0 returned 100%
call    1 returned 100%
branch  2 taken 100% (fallthrough)
branch  3 taken 0% (throw)
        1:   63:  bson_init (&keys);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   64:  BSON_APPEND_INT32(&keys, index.c_str(), 1);
call    0 returned 100%
call    1 returned 100%
call    2 returned 100%
branch  3 taken 100% (fallthrough)
branch  4 taken 0% (throw)
        1:   65:  index_name = mongoc_collection_keys_to_index_string(&keys);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   66:  create_indexes = BCON_NEW (
call    0 returned 100%
call    1 returned 100%
branch  2 taken 100% (fallthrough)
branch  3 taken 0% (throw)
call    4 returned 100%
call    5 returned 100%
branch  6 taken 100% (fallthrough)
branch  7 taken 0% (throw)
call    8 returned 100%
call    9 returned 100%
branch 10 taken 100% (fallthrough)
branch 11 taken 0% (throw)
call   12 returned 100%
call   13 returned 100%
call   14 returned 100%
branch 15 taken 100% (fallthrough)
branch 16 taken 0% (throw)
        -:   67:      "createIndexes", BCON_UTF8(db_name.c_str()),
        -:   68:      "indexes", "[", "{",
        -:   69:          "key", BCON_DOCUMENT (&keys),
        -:   70:          "name", BCON_UTF8 (index_name),
        -:   71:          "unique", BCON_BOOL(unique),
        1:   72:      "}", "]");
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        -:   73:  r = mongoc_database_write_command_with_opts (
        1:   74:      db, create_indexes, NULL, &reply, &error);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   75:  if (!r) {
branch  0 taken 0% (fallthrough)
branch  1 taken 100%
    #####:   76:    LOG(error) << "Error in createIndexes: " << error.message;
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
call    6 never executed
branch  7 never executed
branch  8 never executed
call    9 never executed
branch 10 never executed
branch 11 never executed
call   12 never executed
branch 13 never executed
branch 14 never executed
call   15 never executed
call   16 never executed
branch 17 never executed
branch 18 never executed
call   19 never executed
call   20 never executed
branch 21 never executed
branch 22 never executed
call   23 never executed
branch 24 never executed
branch 25 never executed
call   26 never executed
branch 27 never executed
branch 28 never executed
call   29 never executed
branch 30 never executed
branch 31 never executed
call   32 never executed
branch 33 never executed
branch 34 never executed
call   35 never executed
branch 36 never executed
branch 37 never executed
call   38 never executed
branch 39 never executed
branch 40 never executed
call   41 never executed
branch 42 never executed
branch 43 never executed
call   44 never executed
branch 45 never executed
branch 46 never executed
call   47 never executed
branch 48 never executed
branch 49 never executed
call   50 never executed
call   51 never executed
call   52 never executed
        -:   77:  }
        1:   78:  bson_free (index_name);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   79:  bson_destroy (&reply);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   80:  bson_destroy (create_indexes);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        1:   81:  mongoc_database_destroy(db);
call    0 returned 100%
branch  1 taken 100% (fallthrough)
branch  2 taken 0% (throw)
        -:   82:
        1:   83:  return r;
        -:   84:}
        -:   85:
        -:   86:} // namespace social_network
        -:   87:
        -:   88:#endif //SOCIAL_NETWORK_MICROSERVICES_SRC_UTILS_MONGODB_H_
